- name: Accept Zerotier
  become: true
  when: firewall_zerotier
  ansible.builtin.iptables:
    chain: INPUT
    protocol: udp
    destination_port: 9993
    jump: ACCEPT
    comment: zerotier

- name: Accept Zerotier
  become: true
  when: firewall_zerotier
  ansible.builtin.iptables:
    chain: INPUT
    protocol: udp
    destination_port: 9993
    jump: ACCEPT
    ip_version: ipv6
    comment: zerotier v6

- name: Accept https traffic
  become: true
  when: firewall_https
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    destination_port: 443
    jump: ACCEPT
    comment: https

- name: Accept https traffic
  become: true
  when: firewall_https
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    destination_port: 443
    jump: ACCEPT
    ip_version: ipv6
    comment: https v6

# This will apply to all loaded/active IPv4 tables.
- name: Save current state of the firewall in system file
  become: true
  when: firewall_persist
  community.general.iptables_state:
    state: saved
    path: /etc/iptables/rules.v4

# This will apply only to IPv6 filter table.
- name: save current state of the firewall in system file
  become: true
  when: firewall_persist
  community.general.iptables_state:
    ip_version: ipv6
    table: filter
    state: saved
    path: /etc/iptables/rules.v6
