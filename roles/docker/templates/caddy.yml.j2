services:
  caddy:
    image: caddy
    restart: unless-stopped
    container_name: caddy

{% if caddy_capabilities %}
    cap_add:
{% for line in caddy_capabilities %}
      - "{{ line }}"
{% endfor %}
{% endif %}

{% if caddy_ports %}
    ports:
{% for line in caddy_ports %}
      - "{{ line }}"
{% endfor %}
{% endif %}

    volumes:
      - "{{caddy_conf}}:/etc/caddy"
      - "{{caddy_srv}}:/srv:ro"
      - "caddy-data:/data"
      - "caddy-config:/config"
{% if caddy_certs %}
      - "{{caddy_certs}}:/etc/ssl/private:ro"
{% endif %}
volumes:
    caddy-config:
    caddy-data:
